id: 1442
author:
  name: Micha≈Ç
  url: http://margielewski.pl
date: 2014-10-26T15:43:48.0000000-04:00
content: "you can write like this:\n\npublic static T InvokeJson(string server, string methodName, string jsonObject)\n        {\n            string requestUrl = server + methodName;\n            HttpWebRequest request = (HttpWebRequest)HttpWebRequest.Create(requestUrl);\n            request.ContentType = \"application/json; charset=utf-8\";\n            request.Accept = \"application/json, text/javascript, */*\";\n            request.Method = \"POST\";\n\n            using (StreamWriter writer = new StreamWriter(request.GetRequestStream()))\n            {\n                writer.Write(jsonObject);\n                writer.Close();\n            }\n            \n            WebResponse response = request.GetResponse();\n            Stream stream = response.GetResponseStream();\n            StringBuilder sb = new StringBuilder();\n\n            using (StreamReader reader = new StreamReader(stream))\n            {\n                while (!reader.EndOfStream)\n                {\n                    sb.AppendLine(reader.ReadLine());\n                }\n            }\n            T output = JSONManager.ToObject(sb.ToString());\n            return output;\n        }\n\n\nand this code invoke like this:\n\nDoServiceCall(delegate()\n            {\nInitializeResponse output = Helper.InvokeJson(SelectedJsonAddress, \"Initialize\", sendRequest);\n});\n\nand catch exception like this:\n\npublic void DoServiceCall(DoServiceFunction function)\n        {\n            try\n            {\n                function();\n            }\n            catch (WebException ex)\n            {\n                HandleException(ex);\n\n                Stream stream = ex.Response.GetResponseStream();\n                StringBuilder sb = new StringBuilder();\n                using (StreamReader reader = new StreamReader(stream))\n                {\n                    while (!reader.EndOfStream)\n                    {\n                        sb.AppendLine(reader.ReadLine());\n                    }\n                }\n                string msg = sb.ToString();\n                writeOutputToControl(msg);\n                FacadeException errMsg = JSONManager.ToObject(msg);\n\n                writeOutputToControl(string.Format(\"Content: {0}ErrorCode: {1}{2}Message: {3}{4}DebugMessage:{5}\",\n                    Environment.NewLine, errMsg.ErrorCode,\n                    Environment.NewLine, errMsg.Message,\n                    Environment.NewLine, errMsg.DebugMessage));\n            }\n            catch (Exception e)\n            {\n                HandleException(e);\n            }\n            finally\n            {\n            }\n        }"
