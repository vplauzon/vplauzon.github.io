---
title: 'How to improve Azure: Security Models'
date: 2014-04-28 17:20:00 -07:00
permalink: /2014/04/28/how-to-improve-azure-security-models/
categories:
- Solution
tags:
- Security
---
<p>In <a href="http://vincentlauzon.wordpress.com/2014/03/06/how-to-improve-azure/">this blog series</a> I explore some of the shortcomings of the Microsoft Azure platform (as of this date, April 2014) and discuss ways it could be improved. This isn’t a rant against the platform: I’ve been using and promoting the platform for more than four (4) years now and I’m very passionate about it. Here I am pointing at problems and suggesting solutions. Feel free to jump in the discussion in the comments section!</p>  <p>The past blog entries are:</p>  <ul>   <li><a href="http://vincentlauzon.wordpress.com/2014/03/07/how-to-improve-azure-can-you-keep-a-secret/">Can you keep a Secret</a>? </li> </ul>  <p>&#160;</p>  <p>What is the security model of Microsoft Azure?</p>  <p>This question is at the heart of the weakness I would like to discuss in this article:&#160; there are no unique security model in Azure.&#160; There are a plethora of models, depending on which Services you are consuming.&#160; Let’s look at some examples:</p>  <ul>   <li>Azure Storage:&#160; you can either use an access key (there are two:&#160; primary or secondary) in the Authorization cookie of HTTP requests, which gives you all privileges within an entire storage account or you can use Shared Access Signature (SAS) that you place in the query strings of your HTTP requests, which gives you limit access (see <a href="http://msdn.microsoft.com/en-us/library/dn568102.aspx">valet key</a>).&#160; There are actually two flavours of SAS, an ad hoc form and a more permanent one.</li>    <li>SQL Azure:&#160; user name / password of an SQL Account.&#160; This is the same mechanism used with on-premise SQL Server that has been discouraged by Microsoft to used in opposition to the Windows Integrated mechanism, which isn’t supported by SQL Azure.</li>    <li>Service Bus:&#160; access token provided by Access Control Service (ACS) or a SAS (independent of the Azure Storage SAS).&#160; Both mechanisms can give limited access to resources (see <a href="http://vincentlauzon.wordpress.com/2013/12/04/securing-azure-messaging-service-bus-access/">my past blog on how to secure Service Bus access</a>).</li>    <li>Azure Active Directory Graph API:&#160; JWT access token provided by Azure Active Directory using OAuth-2.</li> </ul>  <p>Those are just a few and they are the access to the service itself.&#160; When you want to manage those services (e.g. creating an SQL Azure Database), you may have a different security model.</p>  <p>If you use Microsoft Azure lightly, i.e. one or two services, it might not appear as a problem.&#160; Once you start using Azure a bit more as a development platform, then this lack of uniformity will hit you:</p>  <ol>   <li>You have a lot of protocols to understand and implement.</li>    <li>You need to work around different limitations, e.g. I can be very granular on access on the Service Bus but with SAS Policies in Azure Storage, the SAS is good for an entire container.</li>    <li>You have a lot of secrets to store, since many Services do not share secrets (see <a href="http://vincentlauzon.wordpress.com/2014/03/07/how-to-improve-azure-can-you-keep-a-secret/">my blob on secrets for more details</a>).</li>    <li>You have a lot of credentials to manage, e.g. you need to implement retention policies and renew different secrets in different services which all have different management interfaces.&#160; This increases the chances of error or more typically, of not automating such policies.</li> </ol>  <p>&#160;</p>  <p>How could we fix that?</p>  <p>&#160;</p>  <p>I would propose a dual security model for each Service.</p>  <p>The primary Security Model would be Claims based and not even limited to Microsoft Azure Active Directory but open to any Identity provider.&#160; For ease of use, your Azure Subscription could be configured with a set of trusted Identity Provider (i.e. URI &amp; signing keys, token type).&#160; When you want to configure an access you could then have a standard dialog where you pick the Identity Provider and compose a Claims rule (e.g. I want the claim type &amp; claim value or those types &amp; value, or either this combination or that one, etc. .).</p>  <p>This would enable your solution to have Service Identities managed wherever you want (although Azure Active Directory would be easier since it is part of the platform) and the same Identity could be used to access SQL Azure, Service Bus, Media Services, etc.&#160; .&#160; Quite a bit like we do on-premise with Service Accounts.</p>  <p>The access token provided by the Identity provider would need to be passed in the Authorization cookie at each HTTP Request or differently for different protocol (e.g. TCP TDS for SQL, proprietary TCP for Service Bus, etc.).</p>  <p><a href="/assets/posts/2014/2/how-to-improve-azure-security-models/image.png"><img title="image" style="border-top:0;border-right:0;background-image:none;border-bottom:0;padding-top:0;padding-left:0;border-left:0;display:inline;padding-right:0;" border="0" alt="image" src="/assets/posts/2014/2/how-to-improve-azure-security-models/image_thumb.png" width="475" height="273" /></a></p>  <p>The secondary Security Model could be unique to each Service but would typically address the shortcomings of the primary one.&#160; The primary model I define here requires access to an Identity Provider (this one must be up), configuration of an account in that Provider, etc.&#160; .&#160; A simpler Security Model, e.g. SAS, would be quite good for faster ramp-up with a Service (although it has the weakness of multiplying the number of secrets).</p>  <p>&#160;</p>  <p>With this Primary / Secondary Security Model we would have a robust security model (Primary) and one for quicker use (Secondary).&#160; When using the primary security model, it is quite possible to have only one secret to store for an application:&#160; the user name &amp; password of the Service Identity associated with the application.&#160; This would allow for central management of the secret and much less complex logic to store and use the secrets.</p>  <p>&#160;</p>  <p>Hope this was useful!</p>