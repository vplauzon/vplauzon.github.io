---
title:  How to improve Azure: Granularity of access
date:  2014-05-03 23:15:00 +00:00
permalink:  "/2014/05/03/how-to-improve-azure-granularity-of-access/"
categories:
- Solution
tags:
- Security
---
<p>In <a href="http://vincentlauzon.wordpress.com/2014/03/06/how-to-improve-azure/">this blog series</a> I explore some of the shortcomings of the Microsoft Azure platform (as of this date, April 2014) and discuss ways it could be improved. This isn’t a rant against the platform: I’ve been using and promoting the platform for more than four (4) years now and I’m very passionate about it. Here I am pointing at problems and suggest solutions. Feel free to jump in the discussion in the comments section!</p>  <p>The past blog entries are:</p>  <ul>   <li><a href="http://vincentlauzon.wordpress.com/2014/03/07/how-to-improve-azure-can-you-keep-a-secret/">Can you keep a Secret</a>? </li>    <li><a href="http://vincentlauzon.wordpress.com/2014/04/28/how-to-improve-azure-security-models/">Security Models</a> </li> </ul>  <p>In <a href="http://vincentlauzon.wordpress.com/2014/04/28/how-to-improve-azure-security-models/">my last post</a>, I discussed about the variety of security models in the Azure platform, i.e. the different ways to authenticate or to get access to a resource.&#160; This time, I would like to discuss the granularity of access.</p>  <p>In any system, once you are authenticated, you are authorized to some access / actions.&#160; Access comes in different flavours:&#160; read/write, create/delete, etc.&#160; .</p>  <p>A recurring theme in authorization schemes is the concept of a hierarchy of rights in order to get around the complexity related to fine granularity of access.&#160; For example, in both Windows File System &amp; SharePoint, each file can be denied to a group or specific users but typically access is managed at a higher level, e.g. folders, library, site, site collection, etc.&#160; .</p>  <p>If we now look at different Azure services, we’ll find the same the same diversity we found in security models.</p>  <p>SQL Azure has the same authorization scheme than SQL Server, i.e. Database, Schemas, objects (e.g. tables, views).&#160; Service Bus has three possible actions, <em>manage</em>, <em>read</em> &amp; <em>write</em> and those can be hierarchically given to an entire namespace or some sub domain.&#160; Active Directory has two permissions for the Graph API, <em>read</em> &amp; <em>read-write</em> applied to the entire directory.</p>  <p>Now the weakness I’ve experimented is the lack of granularity in some services, mainly Azure Storage &amp; Active Directory.</p>  <p>Active Directory Graph API grants read or read-write access to the entire directory.&#160; I cannot give to an application the ability to manage only some groups:&#160; it’s a master switch, once I gave the access, it’s total.</p>  <p>In the case of Azure Storage, there is two types of access:&#160; via SAS or via access keys.&#160; With the access key, you’re the king of the entire storage account:&#160; you can create / delete containers and read-write wherever you want.&#160; The SAS comes in two flavours.&#160; Ad hoc ones have quite granular access:&#160; they can be given to a file with read or read-write access or on a container with read, read-write, or list (to obtain the list of files).&#160; SAS policies on the other hand are good for an entire container so once you give one to a system, it can do whatever you authorized it to do (e.g. write) to the entire container.&#160; So ad-hoc SAS sounds good, don’t they?&#160; Except they are short lived and must be created…&#160; using the access keys!</p>  <p>&#160;</p>  <p>The main problem with not having fine grain enough access controls is that you end up giving more access that you want to.&#160; I give you access to write in this entire blob container but please write only in this sub folder.&#160; If files start to disappear, you’ll be on the list of suspects though.</p>  <p>There is an overarching principle in Information Technology, <a href="http://en.wikipedia.org/wiki/Principle_of_least_privilege">Principle of least privilege</a>, give access to an agent ONLY what they need to do their business.&#160; In order to do that, you need the underlying platform to support that.</p>  <p>Microsoft Pattern &amp; Practices has a corresponding pattern, the <a href="http://msdn.microsoft.com/en-us/library/dn568102.aspx">valet key pattern</a>.&#160; This is a quite specialized view on the principle of least privilege, limited to SAS.&#160; The problem with SAS, as I mentioned in previous articles, is that it multiplies the number of secrets you need to keep as a system.&#160; If, as a system, I access 10 resources, I need to keep 10 SAS, i.e. 10 secrets since if I divulge a SAS to a third party, said third party now has access it shouldn’t have.&#160; An authentication / authorization mechanism minimizes the number of secrets to one:&#160; the secret you need to authenticate.</p>  <p>&#160;</p>  <p>So…&#160; how can we improve?</p>  <p>Well, the conceptual solution is quite easy:</p>  <ul>   <li>Make sure to have the most granular access scheme possible</li>    <li>Use other mechanisms, e.g. hierarchy, to ensure the granularity doesn’t make the access unmanageable</li> </ul>  <p>This is quite coupled with the <a href="http://vincentlauzon.wordpress.com/2014/04/28/how-to-improve-azure-security-models/">previous article</a> about unifying the security models:&#160; you need to authenticate a user / agent in order to grant them access.&#160; But even with SAS you could go more granular than is currently the case.</p>