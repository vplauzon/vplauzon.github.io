---
title: 'Applied SOA: Part 8–Security'
date: 2012-02-09 20:13:00 -05:00
permalink: /2012/02/09/applied-soa-part-8security/
categories:
- Solution
tags:
- API
---
<p>This is part of a series of blog post about Applied SOA. The past blog entries are:</p>  <ul>   <li><a href="http://vincentlauzon.wordpress.com/2011/06/17/applied-soa-part-1-introduction/">Introduction</a> </li>    <li><a href="http://vincentlauzon.wordpress.com/2011/11/27/applied-soa-part-2-soa-basics/">SOA Basics</a> </li>    <li><a href="http://vincentlauzon.wordpress.com/2011/11/29/applied-soa-part-3-service-discovery-process/">Service Discovery Process</a> </li>    <li><a href="http://vincentlauzon.wordpress.com/2011/12/09/applied-soa-part-4-service-taxonomy/">Service Taxonomy</a> </li>    <li><a href="http://vincentlauzon.wordpress.com/2011/12/13/applied-soa-part-5-interoperability/">Interoperability</a> </li>    <li><a href="http://vincentlauzon.wordpress.com/2011/12/21/applied-soa-part-6service-composition/">Service Composition</a> </li>    <li><a href="http://vincentlauzon.wordpress.com/2012/01/06/applied-soa-part-7system-consistency/">System Consistency</a> </li> </ul>  <p>In this article, I’ll cover security.&#160; Security is a very broad topic and by no mean unique to SOA.&#160; I’ll focus on what is specific about service security.</p>  <p>I once had a colleague whose mantra around security was the <em>triple ‘A’</em>:</p>  <ul>   <li>Authentication </li>    <li>Authorization </li>    <li>Audit </li> </ul>  <p>I actually find that triple ‘A’ a very good summary of security concerns in most systems:&#160; who are you, what can you do with the system and keeping traces of what you did.</p>  <h3>Authentication</h3>  <p>When a service is invoked, it is done by something (e.g. a browser, another service, etc.) on behalf of somebody (e.g. an end user, a system user, an anonymous agent).</p>  <p>Some concerns jump in:</p>  <ul>   </ul><ul>     <li>How do we identify users in your system, i.e. what is the identity model in your system?&#160; Is the identity a username?&#160; A SID?&#160; A set of claims? </li>      <li>What is the authentication process, what are the credentials involved?&#160; User name / password?&#160; Certificate? </li>      <li>Where and when is the authentication done?&#160; Once and a proof of that authentication (e.g. token, cookie) is transported thereafter or is it done at each tier boundary?&#160; Service boundary? </li>      <li>How does it flow through service composition?&#160; Does the end user identity flows all the way or does the identity of services take over somewhere in the pipeline?&#160; How do you address the case where a service composition is done through asynchronous means, i.e. can the invoker identity be stored with the asynchronous message? </li>   </ul>   <p>In the Microsoft realm of technology, some classical approach exist.&#160; Using Windows Authentication is often used within a corporate network as a secure way to authenticate user with little friction (user is already logged in on his / her workstation).&#160; Identity can flow via impersonnification or caller context.&#160; The database is often considered a trusted subsystem, i.e. that it doesn’t require the end-user identity, trusting the calling services.&#160; In some cases, you might want to flow the identity right through the database though, in order to strictly enforce security policy.</p>  <p>Outside corporate firewalls identity is often managed using custom means, i.e. username / password and a combination of cookie &amp; custom token.&#160; Claims based security model is rising and becoming more common but is still a young technology.&#160; Interoperability is a challenge with Claims based as very little products support it hence you would have problem to flow the identity everywhere.&#160; This is often managed by having a security policy of controlling the user identity at the Enterprise boundary and then flowing the service identity.</p>  <h3>Authorization</h3>  <p>Now that you know the identity of the agent invoking your service, how do you control access?&#160; Many models are possible given the following variables:</p>  <ul>   <li>Are you going to be context insensitive (e.g. this operation requires role X to execute) or context sensitive (e.g. this operation requires role X and role Y.&lt;the name of the department you are trying to access&gt; to execute)? </li>    <li>Are you going to control the access at the operation border only?&#160; If so, a user can either invoke your service operation or not.&#160; You might also need to control what the user can see and perform security trimming even once the user has been given access to the service operation. </li>    <li>Are you going to grant access based on role (<a href="http://en.wikipedia.org/wiki/Role-based_access_control">RBAC</a>), to a set of claims or to a set of permissions, itself determined from role, claims and other data about the user identity? </li>    <li>Where are you going to control access?&#160; Everywhere?&#160; At an entry point only? </li> </ul>  <p>Typically, you’ll have a mix of those variables in your system.&#160; Just being aware of them and which compromise you are making in your architecture will go a great way of ensuring the clarity of the security model, how well it will be understood by different stakeholder and hence the strength of its eventual implementation.</p>  <h3>Audit</h3>  <p>Often forgotten in security is the audit.&#160; Indeed, we can secure a system with access control (authorization), but another big requirements for a secure system is to be able to trace back what a given user did or who did what in a system.</p>  <p>Audit is the ability of tracing back actions.&#160; This is typically enabled by logging actions to a store.</p>  <p>Now the first question you need to ask yourself is if you’ll need to audit <em>easily</em>, i.e. via some UI with search facilities, etc. in which case you want the logging information to be easily mined or is audit going to come as a consequence of some rare legal problems, in which case you just want the information to be <em>available</em> so that some professional could go and mine the information on a need-to base.</p>  <p>Logging can be done at different level:</p>  <ul>   <li>At the service boundary you can log information about an operation, payload in / out, time of request, identity of the user, etc.&#160; .&#160; In an SOA architecture, this should be sufficient to reconstruct user actions.</li>    <li>You can continue to log within a service, at different layer, even going as far as logging DB access.&#160; This is useful if your service implementation changes often or if their logic is strongly influenced by some configurable sources (e.g. business rule engine in BizTalk, custom application configuration, etc.) in which case service operation treatment might vary over time and it could be hard to reconstruct actions just by looking at service log.</li> </ul>  <p>You can log actions within your system, e.g. by stamping changes with a user name, by keeping all changes, etc.&#160; .&#160; This is done by systems such as TFS which never forget anything.&#160; It is easier to do in such systems because they have generic entity management system.&#160; On system managing many type of entities (e.g. many tables in a DB), it can become difficult to keep all changes in the system without cluttering information schema.&#160; In those cases, you might want to perform logging on the side, e.g. in log files.</p>  <p>Regardless of where you log, it might be challenging to reconstruct user actions from log.&#160; So it’s better to think in advance at what type of reconstruction you would need to do to make sure it will be feasible.&#160; Often the reconstruction scenarios are simple, e.g. who changed the salary of X?&#160; But sometimes, it can be harder, for instance, if you need to reconstruct a long running business process where different people can have played a different role.</p>  <p>Again, you’ll often end up with a mix of the options presented here, i.e. logging on the side + keeping last changes in store which you can then expose at the application level.</p>  <h3>Golden rule</h3>  <p>Architect with security in mind day 1!</p>  <p>We repeat that everywhere all the time but more often than not, security comes second.&#160; This is actually quite natural since as an architect you typically sit down with business people to specs out an application.&#160; Those stakeholders often have very remote concerns about security.&#160; A good way to get around this tendency is to involve security-aware people (e.g. legal, your Enterprise Security guru) early in the process.</p>