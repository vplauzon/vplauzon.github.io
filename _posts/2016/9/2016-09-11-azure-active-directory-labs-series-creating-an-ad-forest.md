---
title:  Azure Active Directory Labs Series – Creating an AD Forest
date:  09/11/2016 23:00:15
permalink:  "/2016/09/11/azure-active-directory-labs-series-creating-an-ad-forest/"
categories:
- Solution
tags:
- Identity
---
<p>Back in June I had the pleasure of delivering a training on Azure Active Directory to two customer crowds.&nbsp; I say pleasure because not only do I love to share knowledge but also, the preparation of the training forces me to go deep on some aspects of what I’m going to teach.  </p><p>In that training there were 8 labs and I thought it would be great to share them to the more general public.&nbsp; The labs follow each other and build on each other.  </p><p>You can find the exhaustive list in <a href="https://vincentlauzon.com/subject-series/cloud-identity-azure-active-directory/">Cloud Identity &amp; Azure Active Directory</a> page.&nbsp; This is the fifth lab.  </p><p>In the current lab we configure a Virtual Machine (VM) with an Active Directory forest (on premise AD).&nbsp; This lab is a preparation to the next lab where we’ll synchronize that forest with the Azure AD tenant we’ve created before.  <h2>Run Template</h2> <ol> <li>Go to <a href="https://azure.microsoft.com/en-us/documentation/templates/active-directory-new-domain-ha-2-dc/">https://azure.microsoft.com/en-us/documentation/templates/active-directory-new-domain-ha-2-dc/</a><br />This is a community based ARM template for creating an AD forest on Azure VMs.  </li><li>Fill in the template parameters  <ul type="a"> <li>NEWSTORAGEACCOUNTNAME should be a unique name (storage account name)  </li><li>ADMINUSERNAME can be changed to your favorite admin name ; that’s the name of the admin on the VM  </li><li>ADMINPASSWORD should be a secret password  </li><li>ADVMSIZE should be <i>Standard_A1</i>  </li><li>DOMAINNAME should be <i>dm.demo.com</i>  </li><li>DNSPREFIX should be unique, for instance <i>demo-42</i> </li></ul> </li><li>Accept the parameters  </li><li>Create a new resource group named <i>DCs</i>  </li><li>Chose the <i>East-US 2</i> location  </li><li>Read &amp; agree to legal terms (you do this by clicking <i>Purchase</i> but the template itself is free, you only pay for the Azure resources it creates)  </li><li>Click Create </li></ol> <h2>Install AD DS MMC snap in</h2> <ol> <li>RDP into the <i>adBDC</i> VM  </li><li>Validate that for that VM the RDP should be on port 13389 ; this is done by the load balancer NATing 2 VMs RDP on the same IP  </li><li><i>Server Manager</i> application should be opened  </li><li>Right click on ADBDC and select <i>Add Roles and Features</i><br /><a href="assets/2016/9/azure-active-directory-labs-series-creating-an-ad-forest/clip_image0021.jpg"><img title="clip_image002" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image002" src="assets/2016/9/azure-active-directory-labs-series-creating-an-ad-forest/clip_image002_thumb1.jpg" width="325" height="137" /></a>  </li><li>Click next on each tab until <i>Features</i>  </li><li>Scroll down to <i>Remote Server Administration Tools</i>  </li><li>Open the node and dig until you find <i>AD DS Tools</i> ; make sure you have it selected<br /><a href="assets/2016/9/azure-active-directory-labs-series-creating-an-ad-forest/clip_image0041.jpg"><img title="clip_image004" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image004" src="assets/2016/9/azure-active-directory-labs-series-creating-an-ad-forest/clip_image004_thumb1.jpg" width="464" height="324" /></a>  </li><li>Click Next  </li><li>Click install  </li><li>You’ll need to reboot </li></ol> <h2>Add a few users</h2> <ol> <li><i>Server Manager</i> application should be opened  </li><li>Right click on ADBDC and <i>Active Directory Users and Computers</i> should now be available ; select it<br /><a href="assets/2016/9/azure-active-directory-labs-series-creating-an-ad-forest/clip_image0061.jpg"><img title="clip_image006" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image006" src="assets/2016/9/azure-active-directory-labs-series-creating-an-ad-forest/clip_image006_thumb1.jpg" width="458" height="252" /></a>  </li><li>Under the dm.demo.com domain, select the <i>Users</i> folder  </li><li>Right-click the <i>Users</i> folder  </li><li>Select the <i>New</i> contextual menu option and the <i>User</i> sub menu option<br /><a href="assets/2016/9/azure-active-directory-labs-series-creating-an-ad-forest/clip_image0081.jpg"><img title="clip_image008" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image008" src="assets/2016/9/azure-active-directory-labs-series-creating-an-ad-forest/clip_image008_thumb1.jpg" width="463" height="323" /></a>  </li><li>Fill the form with the following fields<br /><i>First Name</i>: Pietro<br /><i>Initials</i>: D<br /><i>Last Name</i>: Maximoff<i><br />Full Name</i>: Pietro D. Maximoff (should be filled automatically)<br /><i>User logon name</i>: pmaximoff<br /><a href="assets/2016/9/azure-active-directory-labs-series-creating-an-ad-forest/clip_image010.jpg"><img title="clip_image010" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image010" src="assets/2016/9/azure-active-directory-labs-series-creating-an-ad-forest/clip_image010_thumb.jpg" width="428" height="366" /></a>  </li><li>Click <i>Next</i>  </li><li>Enter the following password and repeat it in the <i>Confirm password</i> field: Abc123!@#  </li><li>Unselect <i>User must change password at next logon</i>  </li><li>Select <i>Password never expires</i><br /><a href="assets/2016/9/azure-active-directory-labs-series-creating-an-ad-forest/clip_image012.jpg"><img title="clip_image012" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image012" src="assets/2016/9/azure-active-directory-labs-series-creating-an-ad-forest/clip_image012_thumb.jpg" width="470" height="402" /></a>  </li><li>Click <i>Next</i>  </li><li>Click <i>Finish</i>  </li><li>Repeat the steps for another user (use the same password):<br /><i>First Name</i>: Max<br /><i>Initials</i>: (none)<br /><i>Last Name</i>: Eisenhardt<i><br />Full Name</i>: Max Eisenhardt (should be filled automatically)<br /><i>User logon name</i>: meisenhardt  </li><li>Repeat the steps for another user (use the same password):<br /><i>First Name</i>: Steve<br /><i>Initials</i>: (none)<br /><i>Last Name</i>: Rogers<i><br />Full Name</i>: Steve Rogers (should be filled automatically)<br /><i>User logon name</i>: srogers  </li><li>You should see the users you created in the object list<br /><a href="assets/2016/9/azure-active-directory-labs-series-creating-an-ad-forest/clip_image014.jpg"><img title="clip_image014" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image014" src="assets/2016/9/azure-active-directory-labs-series-creating-an-ad-forest/clip_image014_thumb.jpg" width="202" height="150" /></a> </li></ol> <h2>Add a few groups</h2> <ol> <li>Right-click the <i>Users</i> folder  </li><li>Select the <i>New</i> contextual menu option and the <i>Group</i> sub menu option<br /><a href="assets/2016/9/azure-active-directory-labs-series-creating-an-ad-forest/clip_image016.jpg"><img title="clip_image016" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image016" src="assets/2016/9/azure-active-directory-labs-series-creating-an-ad-forest/clip_image016_thumb.jpg" width="445" height="254" /></a>  </li><li>Enter <i>Goodies</i> in the <i>Group name</i> box  </li><li>Click Ok  </li><li>Perform the same sequence for a group named <i>Baddies</i> </li></ol> <h2>Add a Sync User</h2> </p><p>We will add a user to connect to the directory for syncing with Azure AD </p> <ol> <li>Right-click the <i>Users</i> folder  </li><li>Select the <i>New</i> contextual menu option and the <i>User</i> sub menu option<br /><a href="assets/2016/9/azure-active-directory-labs-series-creating-an-ad-forest/clip_image017.jpg"><img title="clip_image017" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image017" src="assets/2016/9/azure-active-directory-labs-series-creating-an-ad-forest/clip_image017_thumb.jpg" width="463" height="323" /></a>  </li><li>Fill the form with the following fields<br /><a href="assets/2016/9/azure-active-directory-labs-series-creating-an-ad-forest/clip_image019.jpg"><img title="clip_image019" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image019" src="assets/2016/9/azure-active-directory-labs-series-creating-an-ad-forest/clip_image019_thumb.jpg" width="404" height="344" /></a>  <ul type="a"> <li>First Name: Sync  </li><li>Initials: (None)  </li><li>Last Name: Account  </li><li>Full Name: Sync Account (should be filled automatically)  </li><li>User logon name: syncaccount </li></ul> </li><li>Click <i>Next</i>  </li><li>Enter the following password and repeat it in the <i>Confirm password</i> field: Abc123!@#  </li><li>Unselect <i>User must change password at next logon</i>  </li><li>Select <i>Password never expires</i><br /><a href="assets/2016/9/azure-active-directory-labs-series-creating-an-ad-forest/clip_image020.jpg"><img title="clip_image020" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image020" src="assets/2016/9/azure-active-directory-labs-series-creating-an-ad-forest/clip_image020_thumb.jpg" width="470" height="402" /></a>  </li><li>Click <i>Next</i>  </li><li>Click <i>Finish</i>  </li><li>In the object list, find <i>Enterprise Admin</i>s &amp; double-click on it  </li><li>Select the <i>Members</i> tab  </li><li>Click the <i>Add</i> button<br /><a href="assets/2016/9/azure-active-directory-labs-series-creating-an-ad-forest/clip_image022.jpg"><img title="clip_image022" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image022" src="assets/2016/9/azure-active-directory-labs-series-creating-an-ad-forest/clip_image022_thumb.jpg" width="332" height="370" /></a>  </li><li>Type <i>Sync Account</i> in the text box &amp; click the <i>Check Names</i> button ; the user account you just created should be resolved<br /><a href="assets/2016/9/azure-active-directory-labs-series-creating-an-ad-forest/clip_image024.jpg"><img title="clip_image024" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image024" src="assets/2016/9/azure-active-directory-labs-series-creating-an-ad-forest/clip_image024_thumb.jpg" width="348" height="188" /></a>  </li><li>Click OK to accept the account  </li><li>Click OK to accept the modification to members  </li><li>The Sync Account now is a member of the Enterprise Admins, which is a prerequisite for AD Connect </li></ol> <h2>Post Lab</h2> <p>Make sure you find all the objects you created in the object list.</p>