---
title:  Azure Active Directory Labs Series – AD Connect
date:  2016-09-14 19:00:09 -04:00
permalink:  "/2016/09/14/azure-active-directory-labs-series-ad-connect/"
categories:
- Solution
tags:
- Identity
---
<p>Back in June I had the pleasure of delivering a training on Azure Active Directory to two customer crowds.&nbsp; I say pleasure because not only do I love to share knowledge but also, the preparation of the training forces me to go deep on some aspects of what I’m going to teach.  </p><p>In that training there were 8 labs and I thought it would be great to share them to the more general public.&nbsp; The labs follow each other and build on each other.  </p><p>You can find the exhaustive list in <a href="https://vincentlauzon.com/subject-series/cloud-identity-azure-active-directory/">Cloud Identity &amp; Azure Active Directory</a> page.&nbsp; This is the sixth lab.  </p><p>In the current lab we configure AD Connect to synchronize on premise AD with Azure AD.&nbsp; We will install AD Connect on one of the Domain Controller created in an earlier lab. In a more realistic environment you would install AD Connect on a separate VM joined to the Domain Controller’s domain. The configuration would be very similar.  <h2>Configure Azure AD</h2> <ol> <li>Go to the legacy portal @ <a href="https://manage.windowsazure.com">https://manage.windowsazure.com</a>  </li><li>Scroll down the left menu to the bottom and select <i>Active Directory</i><br /><a href="http://vincentlauzon.files.wordpress.com/2016/09/clip_image0022.jpg"><img title="clip_image002" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image002" src="http://vincentlauzon.files.wordpress.com/2016/09/clip_image002_thumb2.jpg" width="161" height="165" /></a>  </li><li>You should see the following screen<br /><a href="http://vincentlauzon.files.wordpress.com/2016/09/clip_image0042.jpg"><img title="clip_image004" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image004" src="http://vincentlauzon.files.wordpress.com/2016/09/clip_image004_thumb2.jpg" width="531" height="102" /></a>  </li><li>Select a tenant you created for this lab &amp; enter it<br /><a href="http://vincentlauzon.files.wordpress.com/2016/09/clip_image0062.jpg"><img title="clip_image006" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image006" src="http://vincentlauzon.files.wordpress.com/2016/09/clip_image006_thumb2.jpg" width="566" height="56" /></a>  </li><li>Select the <i>Users</i> menu  </li><li>At the screen bottom, click the <i>Add User</i> button  </li><li>An <i>Add User</i> dialog should appear  </li><li>For <i>User Name</i>, type <i>SyncAdmin</i>  </li><li>Click the next arrow at the bottom of the pop up  </li><li>Fill the <i>User Profile</i> form  <ul type="a"> <li>First Name: <i>Sync</i>  </li><li>Last Name: <i>Admin</i>  </li><li>Display Name: <i>Sync Admin</i>  </li><li>Role: <i>Global Admin</i>  </li><li>Alternate email address: type your corporate email here </li></ul> </li><li>Click the next arrow at the bottom of the pop up  </li><li>Click the <i>Create</i> button  </li><li>Copy the temporary password  </li><li>Create a permanent password for the newly created account  <ol type="a"> <li>Open an <i>In private Browser Window</i>  </li><li>Navigate to <a href="https://portal.azure.com">https://portal.azure.com</a>  </li><li>In the <i>Email or Phone</i>, type the full name of the account<br />You can find the name in the full name of your account in the last <i>Add User screen</i> (of course, you need to remove the single quotes)<br /><a href="http://vincentlauzon.files.wordpress.com/2016/09/clip_image0082.jpg"><img title="clip_image008" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image008" src="http://vincentlauzon.files.wordpress.com/2016/09/clip_image008_thumb2.jpg" width="479" height="163" /></a>  </li><li>In the <i>password</i> text box, paste the <i>new password</i> you copied previously  </li><li>Click <i>Sign In</i>  </li><li>You’ll be prompted to update the password ; do so &amp; remember the new password  </li><li>Close the <i>In private browser</i> </li></ol> </li><li>Back in the classic Azure portal, select the <i>Directory Integration</i> menu<br /><a href="http://vincentlauzon.files.wordpress.com/2016/09/clip_image0101.jpg"><img title="clip_image010" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image010" src="http://vincentlauzon.files.wordpress.com/2016/09/clip_image010_thumb1.jpg" width="662" height="65" /></a>  </li><li>Next to the <i>Directory Sync </i>select <i>Activated</i> option<br /><a href="http://vincentlauzon.files.wordpress.com/2016/09/clip_image0121.jpg"><img title="clip_image012" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image012" src="http://vincentlauzon.files.wordpress.com/2016/09/clip_image012_thumb1.jpg" width="485" height="240" /></a>  </li><li>At the bottom of the screen, click the <i>Save</i> button </li></ol> <h2>Installing AD Connect</h2> <ol> <li>Go to the Azure portal @ <a href="https://portal.azure.com">https://portal.azure.com</a>  </li><li>In the left column menu, select <i>Resource Groups</i><br /><a href="http://vincentlauzon.files.wordpress.com/2016/09/clip_image0141.jpg"><img title="clip_image014" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image014" src="http://vincentlauzon.files.wordpress.com/2016/09/clip_image014_thumb1.jpg" width="211" height="116" /></a>  </li><li>Select <i>DCGroup</i>  </li><li>Select <i>adBDC</i> Virtual machine  </li><li>RDP into it  </li><li>Go to <a href="http://go.microsoft.com/fwlink/?LinkId=615771">http://go.microsoft.com/fwlink/?LinkId=615771</a>  </li><li>Download the AD Connect tool  </li><li>Install it  </li><li>Agree on terms &amp; conditions  </li><li>Given the simplicity of the setup (one forest, same VM as the DC), we can use the express settings<br />Select <i>Use express settings</i><br /><a href="http://vincentlauzon.files.wordpress.com/2016/09/clip_image0161.jpg"><img title="clip_image016" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image016" src="http://vincentlauzon.files.wordpress.com/2016/09/clip_image016_thumb1.jpg" width="477" height="335" /></a>  </li><li>The tool will install components as part of <i>Synchronisation Service</i> install, click <i>Install</i>  </li><li>Fill the <i>Connect to Azure AD</i> form<br /><a href="http://vincentlauzon.files.wordpress.com/2016/09/clip_image018.jpg"><img title="clip_image018" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image018" src="http://vincentlauzon.files.wordpress.com/2016/09/clip_image018_thumb.jpg" width="403" height="207" /></a>  <ol type="a"> <li>In the <i>User name</i> box, type the full name of the <i>SyncAdmin</i> account you created  </li><li>In the password box, type the password you typed when you updated the password of the account </li></ol> </li><li>Click the <i>Next</i> button  </li><li>Fill <i>Connect to AD DS </i>form <br /><a href="http://vincentlauzon.files.wordpress.com/2016/09/clip_image0201.jpg"><img title="clip_image020" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image020" src="http://vincentlauzon.files.wordpress.com/2016/09/clip_image020_thumb1.jpg" width="468" height="178" /></a>  <ol type="a"> <li>In user name box, type <i>dm.demo.com\syncaccount</i>  </li><li>Enter the password you gave that account (likely <i>Abc123!@#</i>) </li></ol> </li><li>Click the <i>Next</i> button  </li><li>Select <i>Continue without any verified domains</i> and click <i>Next</i><br /><a href="http://vincentlauzon.files.wordpress.com/2016/09/clip_image0221.jpg"><img title="clip_image022" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image022" src="http://vincentlauzon.files.wordpress.com/2016/09/clip_image022_thumb1.jpg" width="504" height="355" /></a>  </li><li>You are ready to start synchronization, click <i>Install</i><br /><a href="http://vincentlauzon.files.wordpress.com/2016/09/clip_image0241.jpg"><img title="clip_image024" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image024" src="http://vincentlauzon.files.wordpress.com/2016/09/clip_image024_thumb1.jpg" width="452" height="322" /></a>  </li><li>The installation &amp; synchronization takes a few minutes  </li><li>Configuration should complete<i><br /></i><a href="http://vincentlauzon.files.wordpress.com/2016/09/clip_image026.jpg"><img title="clip_image026" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image026" src="http://vincentlauzon.files.wordpress.com/2016/09/clip_image026_thumb.jpg" width="504" height="354" /></a> </li></ol> <h2>Validate synchronization</h2> </p><p>Here we’ll validate that the synchronization occurs. </p> <ol> <li>Back in the Azure AD tenant, select the <i>Users</i> menu  </li><li>You should now see more users  </li><li>Moreover, the users synchronized from on premise should be sourced from <i>Local Active Directory</i> (<i>Sourced From</i> column)<br /><a href="http://vincentlauzon.files.wordpress.com/2016/09/clip_image028.jpg"><img title="clip_image028" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image028" src="http://vincentlauzon.files.wordpress.com/2016/09/clip_image028_thumb.jpg" width="565" height="263" /></a>  </li><li>Select <i>Max Eisenhardt</i> (one of the synchronized account)  </li><li>You should see that fields are grayed out: you can’t modified synchronized objects since Azure AD isn’t the master of record of those objects<br /><a href="http://vincentlauzon.files.wordpress.com/2016/09/clip_image030.jpg"><img title="clip_image030" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image030" src="http://vincentlauzon.files.wordpress.com/2016/09/clip_image030_thumb.jpg" width="468" height="252" /></a>  </li><li>Open an <i>In Private</i> browser window  </li><li>Navigate to <a href="https://portal.azure.com">https://portal.azure.com</a>  </li><li>In <i>email</i> box, type <i>meisenhardt</i> followed by @ &amp; the name of your Azure AD (e.g. <a href="mailto:meisenhardt@vpllab.onmicrosoft.com">meisenhardt@vpllab.onmicrosoft.com</a>)  </li><li>In password box, type the password you gave to on premise accounts (likely <i>Abc123!@#</i>)  </li><li>You should login to the portal with <i>Max Eisenhardt</i> credentials </li></ol> <h2>Refine configuration</h2> <p>Here we’ll look at how we could refine the configuration of AD Connect. </p> <ol> <li>In the Active Directory VM, press the <i>Windows</i> key  </li><li>Press the down key<br /><a href="http://vincentlauzon.files.wordpress.com/2016/09/clip_image032.jpg"><img title="clip_image032" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image032" src="http://vincentlauzon.files.wordpress.com/2016/09/clip_image032_thumb.jpg" width="168" height="202" /></a>  </li><li>Click the <i>Azure AD Connect</i> App<br /><a href="http://vincentlauzon.files.wordpress.com/2016/09/clip_image034.jpg"><img title="clip_image034" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image034" src="http://vincentlauzon.files.wordpress.com/2016/09/clip_image034_thumb.jpg" width="411" height="301" /></a>  </li><li>In the tasks view, select <i>Customize synchronization options</i><br /><a href="http://vincentlauzon.files.wordpress.com/2016/09/clip_image036.jpg"><img title="clip_image036" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image036" src="http://vincentlauzon.files.wordpress.com/2016/09/clip_image036_thumb.jpg" width="484" height="256" /></a>  </li><li>Click Next  </li><li>Fill the <i>Connect to Azure AD</i> form<br /><a href="http://vincentlauzon.files.wordpress.com/2016/09/clip_image038.jpg"><img title="clip_image038" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image038" src="http://vincentlauzon.files.wordpress.com/2016/09/clip_image038_thumb.jpg" width="455" height="243" /></a>  <ol type="a"> <li>In the <i>User name</i> box, type the full name of the <i>SyncAdmin</i> account (Azure AD)  </li><li>In the password box, type the password you typed when you updated the password of the account </li></ol> </li><li>Click Next  </li><li>Fill <i>Connect Directories </i>form <br /><a href="http://vincentlauzon.files.wordpress.com/2016/09/clip_image040.jpg"><img title="clip_image040" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image040" src="http://vincentlauzon.files.wordpress.com/2016/09/clip_image040_thumb.jpg" width="386" height="241" /></a>  <ol type="a"> <li>In user name box, type <i>dm.demo.com\syncaccount</i>  </li><li>Enter the password you gave that account (likely <i>Abc123!@#</i>) </li></ol> </li><li>Click the <i>Next</i> button  </li><li>Here we could filter on which domains / OUs we synchronize<br /><a href="http://vincentlauzon.files.wordpress.com/2016/09/clip_image042.jpg"><img title="clip_image042" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image042" src="http://vincentlauzon.files.wordpress.com/2016/09/clip_image042_thumb.jpg" width="527" height="369" /></a>  </li><li>Click the <i>Next</i> button  </li><li>Here we could configure other features, e.g. password writeback<br /><a href="http://vincentlauzon.files.wordpress.com/2016/09/clip_image044.jpg"><img title="clip_image044" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="clip_image044" src="http://vincentlauzon.files.wordpress.com/2016/09/clip_image044_thumb.jpg" width="937" height="665" /></a> </li></ol> <h2>Post Lab</h2> <p>None.</p>