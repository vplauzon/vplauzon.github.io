---
title:  Shared Access Signature
date:  2010-08-12 17:13:13 -04:00
permalink:  "/2010/08/12/shared-access-signature/"
categories:
- Solution
tags:  []
---
<p>I’ve been spinning by head around to understand how to use this Azure Storage concept for quite a while, so I’ve decided to share my findings.</p>  <p>The most useful web resource I found was this <a href="http://blog.smarx.com/posts/shared-access-signatures-are-easy-these-days">blog entry</a>.&#160; Here I’m gona give a less API-driven approach, which is faster as long as you know which containers / blobs you want to share in advance.</p>  <h3>What is shared access signature good for?</h3>  <h3></h3>  <h3></h3>  <p>The primary way to authenticate is to use the primary or secondary access keys.&#160; This method works fine, but it has three major drawbacks:</p>  <ol>   <li>It gives full access (read &amp; write) </li>    <li>It gives access to the entire storage account (table, queue &amp; blobs). </li>    <li>The only way to revoke access is to regenerate the key, in which case, everybody using it will be denied access. </li> </ol>  <p>Basically, it’s not very granular.&#160; On top of that, the key must be passed in an HTTP header, which isn’t browser friendly.</p>  <p>Shared Access Signature is an alternative way to authenticate against Azure Storage.&#160; As far as I know, it’s only useful for blobs.&#160; It’s granular, since it can go to the blob level to grant permissions, permissions are also more granular (read, write, list, delete) and the revocation can be automatic (duration) or done on each share access.</p>  <h3>How can I use it?</h3>  <p>The easiest way to quickly can a hang of it is to go to <a title="https://myazurestorage.com/" href="https://myazurestorage.com/">https://myazurestorage.com/</a>.&#160; Now this site looks pretty dodgy but it actually belongs to the Windows Azure team, so you can feel free to enter your credentials in.</p>  <p>First thing, you enter the storage account name and the primary key (actually, the secondary works as well).</p>  <p>You can then go to the <em>blobs</em> tab.&#160; If you don’t already have a container, you can create one there.&#160; What I’m going to do here is to give read access to the entire container named <em>content</em>.&#160; I select the <em>Manage Policies</em> menu option on the container menu.</p>  <p><a href="http://vincentlauzon.files.wordpress.com/2010/08/image.png"><img style="display:inline;border-width:0;" title="image" border="0" alt="image" src="http://vincentlauzon.files.wordpress.com/2010/08/image_thumb.png" width="644" height="182" /></a> </p>  <p>There’s a dialog window popping.&#160; I’m going to create a new policy for that container, so I click <em>Add Policy</em>:</p>  <p><a href="http://vincentlauzon.files.wordpress.com/2010/08/image1.png"><img style="display:inline;border-width:0;" title="image" border="0" alt="image" src="http://vincentlauzon.files.wordpress.com/2010/08/image_thumb1.png" width="644" height="294" /></a> </p>  <p>I then fill the policies as follow:</p>  <p><a href="http://vincentlauzon.files.wordpress.com/2010/08/image2.png"><img style="display:inline;border-width:0;" title="image" border="0" alt="image" src="http://vincentlauzon.files.wordpress.com/2010/08/image_thumb2.png" width="644" height="351" /></a> </p>  <p>Basically, I’m creating a policy named “Read”, starting today, ending in 2020 giving read permission.&#160; I click <em>OK</em>.&#160; I then select the <em>Share</em> menu option on the container menu.</p>  <p><a href="http://vincentlauzon.files.wordpress.com/2010/08/image3.png"><img style="display:inline;border-width:0;" title="image" border="0" alt="image" src="http://vincentlauzon.files.wordpress.com/2010/08/image_thumb3.png" width="644" height="184" /></a></p>  <p>Another dialog window pops.&#160; I select the policy I just created (<em>Read</em>) and click the <em>Get URL</em> button:</p>  <p><a href="http://vincentlauzon.files.wordpress.com/2010/08/image4.png"><img style="display:inline;border-width:0;" title="image" border="0" alt="image" src="http://vincentlauzon.files.wordpress.com/2010/08/image_thumb4.png" width="644" height="413" /></a> </p>  <p>The URL looks something like this:</p>  <p><a href="http://blobfoldersync.blob.core.windows.net/content?sr=c&amp;si=Read&amp;sig=j4Rl1%2BPiwm3eUQfFQeIopULLs5SWeIYsXwqx%2FydFXAE%3D">http://&lt;account name&gt;.blob.core.windows.net/content?sr=c&amp;si=Read&amp;sig=j4Rl1%2BPiwm3eUQfFQeIopULLs5SWeIYsXwqx%2FydFXAE%3D</a></p>  <p>If we concentrate on the query string, it contains three components:</p>  <ul>   <li><strong>sr</strong>, the resource, here <em>c</em> which stands for container.&#160; If we shared a blob, it would have been <em>b</em>. </li>    <li><strong>si</strong>, the policy. </li>    <li><strong>sig</strong>, the signature </li> </ul>  <p>I can then use the following code to access the blob container:</p>  <p><font color="#ff0000">var credentials =     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; new StorageCredentialsSharedAccessSignature(&quot;?sr=c&amp;si=Read&amp;sig=j4Rl1%2BPiwm3eUQfFQeIopULLs5SWeIYsXwqx%2FydFXAE%3D&quot;);      <br />CloudBlobClient blobClient = new CloudBlobClient(      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; new Uri(&quot;</font><a href="http://&lt;account name&gt;.blob.core.windows.net&quot;)"><font color="#ff0000">.blob.core.windows.net&quot;)'&gt;http://&lt;account name&gt;.blob.core.windows.net&quot;)</font></a><font color="#ff0000">,     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; credentials); </font></p>  <p><font color="#ff0000">var container = blobClient.GetContainerReference(&quot;content&quot;);     <br />var list = container.ListBlobs(); </font></p>  <p><font color="#ff0000">foreach (CloudBlob blob in list)     <br />{      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Console.WriteLine(blob.Uri);      <br />}</font></p>  <p>I can revoke access to the container by changing the policy.</p>  <h3>How does that work?</h3>  <p>Basically when you click the <em>Get URL</em> button, Azure does spit out a signature and remembers it.&#160; So this URL is good forever, although the policy underneath can change.</p>  <p>We can also share the container directly, without using a policy, but the URL generated would contain the policy itself, ie the start time, end time, etc.&#160; .&#160; It is therefore less secure since if this URL becomes compromise, there is no way to revoke access.&#160; For this reason, the API limits the exposure time to an hour:&#160; we can’t give access for more than an hour this way.</p>  <p>&#160;</p>  <p>Hope that gave shade some lights on the issue of shared access signature, have fun!</p>