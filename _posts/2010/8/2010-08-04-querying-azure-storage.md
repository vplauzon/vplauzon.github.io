---
title:  Querying Azure Storage
date:  2010-08-04 16:39:39 +00:00
permalink:  "/2010/08/04/querying-azure-storage/"
categories:
- Solution
tags:
- Data
---
<p>I’ve been reading the <a href="http://en.wikipedia.org/wiki/CouchDB">Wikipedia article</a> about <a href="http://couchdb.apache.org/">CouchDB</a> lately.&#160; It always impresses me how much engineering effort and men-hours are put into so many competing platforms.&#160; I guess the least we could do is to look at the architecture of those initiatives and get the best out of them.</p>  <p><img style="display:inline;margin-left:0;margin-right:0;" alt="CouchDB - Relax" align="right" src="http://couchdb.apache.org/img/couchdb-logo.png" width="400" height="110" />CouchDB is a <a href="http://en.wikipedia.org/wiki/NoSQL">NoSQL</a> database.&#160; It basically stores JSON documents on potentially many commodity servers in order to scale horizontally.&#160; It supports replication, transactions, a RESTful API, etc.&#160; .&#160; But the bit in the architecture that pique my curiosity was the view engine.</p>  <p>CouchDB sports views on document collections.&#160; Those views are computed by a map reduce algorithm using a given server-side java script functions.&#160; Those views are computed in parallel on the servers.</p>  <p>Well, that’s nice.&#160; I don’t know too much about the reliability implications of having arbitrary code used to computed a view, but I guess you can do as much damage in an SQL view if you put yourself to it.</p>  <p>What I like about that architecture component is that it does respond to a need when you store data:&#160; querying it!&#160; The big question mark for me around Azure Storage has been the querying.&#160; Take the Azure tables:&#160; you have a partition key and a row key.&#160; If you know those, the engine can return you the rows you want in the blink of an eye.&#160; If you don’t but you know the values of other properties (columns), then the engine will do a table scan on all the scaled-out servers.&#160; That sounds a bit extreme to me.</p>  <p><img style="display:inline;margin-left:0;margin-right:0;" align="left" src="http://upload.wikimedia.org/wikipedia/en/f/ff/Windows_Azure_logo.png" />I understand the principles behind it, the Azure tables don’t have schema, the partition key allows you to hint the engine to partition your data, etc.&#160; .&#160; But it seems very low-level to me.&#160; Once I’ve “designed” my table, ie, chosen the partition &amp; row key, I’m locked in that way.&#160; This is where something like CouchDB view engine would come in handy.&#160; Something like an index the engine could use to resolve queries thrown at it.</p>  <p>Actually the CouchDB solution leaves a bit to be desired.&#160; It forces you to know which view to use.&#160; That sounds like the old days of indexes where you had to specify which index to use.</p>  <p>That’s why I would prefer to have an indexing engine sitting next to the table that you could configure separately.</p>  <p>Now, I know that building a distributed index on the scale of Azure Storage (currently maximum 100Tb) must be a daunting tasks with more than one challenge.&#160; But ultimately, the current version of Azure Storage is a bit too “write-only” to be useful in a massive amount of scenarios.</p>  <p></p>  <p>I believe that is part of the storage schizophrenia within Windows Azure, ie SQL Azure versus Azure Storage, there is at the moment.&#160; I couldn’t really quite put my finger on how to fix the Azure Storage and still don’t have a solution, but if an open-project like CouchDB can do it, I’m sure Microsoft can pull it off!</p>