---
title:  Entity Framework 4.0:  POCO or POCO?
date:  2010-11-12 18:24:00 -05:00
permalink:  "/2010/11/12/entity-framework-4-0-poco-or-poco/"
categories:
- Solution
tags:
- .NET
---
<p>The <a href="http://msdn.microsoft.com/en-us/data/ef.aspx">Entity Framework</a> shipping with .NET Framework 4.0 is a major improvement over .NET Framework 3.5 SP1 Entity Framework, which was the first version.&#160; The first version was a nice curiosity but had many shortfall.&#160; For instance, it didn’t support stored procedures, the designer wasn’t flexible, the produced ad hoc queries were quite hard to read, etc. .</p>  <p>EF 4.0 improved on all those fronts.&#160; It is now a very usable Framework and I recommend it.</p>  <p>EF 4.0 also comes with POCO support.&#160; The default usage of EF 4.0 (and EF 3.5 SP1 for that matter) generates entities which are derived from <a href="http://msdn.microsoft.com/en-us/library/system.data.objects.dataclasses.entityobject.aspx">EntityObject</a> and stuffed with attributes.&#160; POCO on the hand lets you generate entities that are <em>Plain Old CLR Objects</em> (POCO).</p>  <p>Now, if you’re like me and you follow Scott Gu’s <a href="http://weblogs.asp.net/scottgu">blog</a>, you might have read an <a href="http://weblogs.asp.net/scottgu/archive/2010/07/16/code-first-development-with-entity-framework-4.aspx">entry about Code-First development</a> in Entity Framework and labelled it “POCO” in your mind.&#160; The blog entry goes on saying it’s in CTP while the other POCO you’ve heard about shipped with .NET Framework 4.0.&#160; What is the difference between those two technologies?</p>  <p>Well…&#160; Many, but they might not impact you all.</p>  <p>Let’s look at the POCO support of EF 4.0.&#160; In order to use that today, you need to change the code generation strategy on your model.&#160; On the EF designer surface, pop the context-menu and select <em>Add Code Generation Item</em>.</p>  <p><a href="http://vincentlauzon.files.wordpress.com/2010/11/image.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="image" border="0" alt="image" src="http://vincentlauzon.files.wordpress.com/2010/11/image_thumb.png" width="243" height="244" /></a>&#160;</p>  <p>This will bring you to an empty Add Item dialog box.&#160; Go to the online template and download the ADO.NET C# POCO Entity Generator:</p>  <p><a href="http://vincentlauzon.files.wordpress.com/2010/11/image1.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="image" border="0" alt="image" src="http://vincentlauzon.files.wordpress.com/2010/11/image_thumb1.png" width="959" height="620" /></a>&#160;</p>  <p>This will download a T4 template on your box.&#160; This generates a slightly different set of classes.&#160; Basically the object-context is similar but the entity sets are POCOs instead of deriving from <a href="http://msdn.microsoft.com/en-us/library/system.data.objects.dataclasses.entityobject.aspx">EntityObject</a>.</p>  <p>That’s it.&#160; That’s what POCO offers you today.</p>  <p>Now what are the drawbacks of that technology?&#160; The main drawback is that the entities are still generated.&#160; So if you would like to use objects provided to you (e.g. WCF data contracts), this mechanism isn’t useful to you.</p>  <p>Now, if you play with the code generated a little you’ll see you can generate it yourself and therefore you fall pretty close to what Code-First development has to offer.</p>  <p>That is if you play with single tables with no relation.&#160; Once you start putting tables with relations you start seeing those <em>FixUp</em> code popping around.&#160; Basically, the management of items in collection isn’t exactly trivial and frankly, it’s a bit messy.&#160; Just have a look of this antic, generated for you:</p>  <blockquote>   <p>public class FixupCollection&lt;T&gt; : ObservableCollection&lt;T&gt;     <br />{      <br />&#160;&#160;&#160; protected override void ClearItems()      <br />&#160;&#160;&#160; {      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; new List&lt;T&gt;(this).ForEach(t =&gt; Remove(t));      <br />&#160;&#160;&#160; } </p>    <p>&#160;&#160;&#160; protected override void InsertItem(int index, T item)     <br />&#160;&#160;&#160; {      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (!this.Contains(item))      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; base.InsertItem(index, item);      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }      <br />&#160;&#160;&#160; }      <br />} </p> </blockquote>  <p>Basically, the Entity Framework was designed on the foundation that entities were tracking themselves.&#160; Once you start introducing POCOs, you remove that foundation and not surprisingly, the building starts to shake.</p>  <p>But not everything is lost, Code-First EF comes in.&#160; With Code-First, you really get your POCO classes.&#160; To take the examples given by Scott on his blog, here’s how your entities look like:</p>  <p><a href="http://weblogs.asp.net/blogs/scottgu/image_25CE75C4.png"><img title="image" border="0" alt="image" src="http://weblogs.asp.net/blogs/scottgu/image_thumb_24F60FDA.png" width="519" height="392" /></a></p>  <p>This is how the object-context looks like:</p> <a href="http://weblogs.asp.net/blogs/scottgu/image_241DA9F0.png"><img title="image" border="0" alt="image" src="http://weblogs.asp.net/blogs/scottgu/image_thumb_1C923A83.png" width="429" height="124" /></a>  <p>Now, that is POCO!</p>  <p>You might have notice that some classes have changed.&#160; Instead of <em>ObjectContext</em> we have DbContext and instead of <em>ObjectSet</em> we have <em>DbSet</em>.&#160; Basically, those classes redo the foundation the other POCO Framework was missing.</p>  <p><img style="display:inline;margin-left:0;margin-right:0;" align="right" src="http://www.christian-movie.com/images/Jenn_Gotzon_ABC_Pushing_Daisies.jpg" width="240" height="187" />Now development-first doesn’t stop there.&#160; You don’t need a mapping XML-file with this Framework.&#160; By default, it uses convention (<a href="http://en.wikipedia.org/wiki/Convention_over_configuration">convention over configuration</a>) to map your objects to tables and columns.&#160; So if you have a table Dinner and an object Dinner, you don’t need to configure anything.&#160; If your object context has the same name than the connection string in your web / app.config, you don’t even need to plug the two together.&#160; Like magic!</p>  <p>Actually, a bonus is that the connection string doesn’t need to be an EF connection string with your SQL connection string embedded in it.&#160; That alone is something!</p>  <p>You can actually have the DB schema generated from your Db-context.&#160; Magic, I told you.</p>  <p>What can you do if your object-model doesn’t map exactly to your DB?&#160; Well, you have to use an API (I don’t know if you can use the mapping file with code-first).&#160; You actually can also annotate your POCO objects.</p>  <p>Now code-first is in CTP.&#160; The fourth CTP was released in July 2010.&#160; They are looking for a vehicle to ship it…&#160; Maybe an SP1 of the Framework?</p>  <p>If you look at all of this, it seems like EF is changing.&#160; The mapping file is slowly fading away, being replaced by an API, new annotation comes in, all the base classes change…&#160; On the other hand, when you use it, it’s pretty much the same.</p>  <p>For me I’ll wait before I use code-first on a real projects. </p>  <p>Here are some resources:</p>  <ul>   <li><a href="http://blogs.msdn.com/b/efdesign/archive/2010/06/01/conventions-for-code-first.aspx">Conventions on Code-First</a></li>    <li><a href="http://blogs.msdn.com/b/efdesign/archive/2010/03/30/data-annotations-in-the-entity-framework-and-code-first.aspx">Data Annotation on Code-First</a></li>    <li><a href="http://msdn.microsoft.com/en-us/magazine/gg232765.aspx">MSDN article about Code First</a> by <a href="http://weblogs.asp.net/jlerman/">Julie Lerman</a>, October 2010</li>    <li><a href="http://hanselman.com/blog/SimpleCodeFirstWithEntityFramework4MagicUnicornFeatureCTP4.aspx">Article</a> by Scott Hansleman on Code First</li> </ul>