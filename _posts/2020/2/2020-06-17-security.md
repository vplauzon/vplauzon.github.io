---
title:  Access Control in Kusto
permalink: /2020/06/17/access-control-in-kusto
categories:
- Solution
tags:
- Data
- Operation
- Security
date: 2020-06-01
---
<img style="float:left;padding-right:20px;" title="From pexels.com" src="/assets/posts/2020/2/access-control-in-kusto/internet-screen-security-protection-60504.jpg" />

When you have a minute‚Ä¶  If you could help me with those (it‚Äôs for Hilo, not CN).

1.	Security ; can you validate my understanding?
a.	We can do role assignment at the db level.  We can do that at the table & function level but just for the admin role.  Doc is unclear about what is the lineage between DB & Table (or DB & function).  Is it additive?  I.e. can you be viewer on the db but admin on a specific table?  Can you not have a role on the db but be admin on a table?
[yifats] Yes, those are possible, but don‚Äôt make much sense. If you have no role on the DB, and you are a table admin, you won‚Äôt be able to query the table (since queries require database access), but you will be able to drop it. +@Ornat Spodek to capture the feedback on the docs, perhaps we can improve these. 
b.	RestrictedViewAccess policy seems to define a second class of table (only?  It doesn‚Äôt seem to be possible on functions).  If a function refers to a restricted table, can I execute the function even if I‚Äôm not an unrestricted viewer?
[yifats] No, you won‚Äôt be able to query the function if it references a restricted table (and you‚Äôre not an unrestricted viewer). That would be a security breach otherwise. The authorization of restricted access is applied on all tables that participate in the query, regardless if they are referred to explicitly or via a function. 
c.	Row level access policy sits ‚Äúon top of it‚Äù and allow row-level access ; it doesn‚Äôt hide table, i.e. I might not be able to see a single row in a table, but I‚Äôll still see the table.  To what role does it apply?  I.e. if I‚Äôm admin on the table, I can ingest into the table ; can I still get restricted read view RLS?
[yifats] It‚Äôs orthogonal to roles. The policy runs every time *anyone* queries the table. You can be an admin on the table and not see all its rows, if the RLS policy query filters out some records. (of course, since you‚Äôre an admin, you can always change the policy for yourself in that case üòä). 
d.	Where does access restriction sit among all those?
[yifats] This is applied per query (unlike the previous 2, which refer to roles / policies). One can restrict entities accessed in a specific query. I guess you could say it‚Äôs applied *on top* of the others. In general, all restrictions are ‚Äòand-ed‚Äô between them (even if the restrict access grants you permissions to the entire schema, you won‚Äôt be able to query restricted tables, if you‚Äôre not an unrestricted user. If you are an unrestricted user, but the restrict access statement hides restricted tables from you in the query, you won‚Äôt be able to see these). 
The restrict access to statement is normally used in services that use Kusto as a multi-tenant store. Middle tier applications of such services prefix every query sent to Kusto with a restrict access statement, to make sure customers can‚Äôt access data of other tenants (for instance, if every tenant has its own set of tables). 
2.	A little related to point 1, can we say that a database is a security boundary and a policy (in general) boundary?  My understanding is there is no perf impact of cross-db query so my db-segmentation design shouldn‚Äôt have perf consideration, right?
[yifats] Yes, a database is a security and policy boundary. The 2nd statement is true today but won‚Äôt be accurate soon. Currently, the entire metadata of all databases is held by a single node (the cluster admin). We‚Äôre working on a ‚Äúmulti-database-admins‚Äù feature, in which the cluster‚Äôs metadata will be split between potentially several nodes, each holding the metadata for a single database. When that work is completed, cross database queries will need to pull metadata from several nodes in order to create a query plan, so there could potentially be some perf impact (it will be cached, of course). The big perf benefit of splitting your data across multiple databases (which is the main reason we‚Äôre introducing the multi-database-admins work), is that the metadata held by each node would be smaller (whereas today some clusters are having memory/CPU issues in the admin node since the clusters metadata is too big and cannot be split between nodes). Additionally, splitting the data between databases allows one to potentially separate some database to separate clusters, if needed (for example, if each tenant has its own database and you want to move a big tenant to its own cluster). 
Bottom line, we definitely recommend to split the data between databases (e.g. per tenant), not only for security/policy reasons. 
3.	Azure Data Share for Data Explorer works at the database level, i.e. I give access to a database.  In scenario where I want to share data with a partner, and in relation to point 2, should I consider segmenting my databases with partners in mind?  Can I restrict further?  For instance, if I have 10 tables I want to share with 4 partners, but only a subnet of those tables to each, instead of having 4 different dbs with duplication of data, is there a way to give access through data share to only a subset of tables?
[yifats] Internally, data share is based on Follower database. It‚Äôs not possible to follow tables (or any entity lower than database). So yes, I guess that should have impact on your database segmentation as well. From the docs: 
                            It isn't possible to follow entities in levels lower than a database (for example, one can't follow a specific table or function, or have table-level policy overrides which aren't specified in table policy overrides).
