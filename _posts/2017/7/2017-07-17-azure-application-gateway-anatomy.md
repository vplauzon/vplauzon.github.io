---
title:  Azure Application Gateway Anatomy
date:  2017-07-17 21:53:54 +00:00
permalink:  "/2017/07/17/azure-application-gateway-anatomy/"
categories:
- Solution
tags:
- Networking
- Web
---
<p>Back in May, <a href="https://vincentlauzon.com/2017/05/08/url-routing-with-azure-application-gateway/">we talked about Azure Application Gateway</a>.</p><p>In this article, we’re going to look at its <em>anatomy</em>, i.e. its internal component as exposed in the Azure Resource Manager (ARM) model.</p><p>A lot of Azure Resource has an internal structure.&nbsp; For instance, a Virtual Network has a collection of subnets.</p><p>Azure Application Gateway has a very rich internal model.&nbsp; We will look at this model in order to understand how to configure it.<h2>What is Azure Application Gateway</h2></p><p>From <a href="https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-create-gateway-arm">the official documentation</a>:</p><p><em>Application Gateway is a layer-7 load balancer.&nbsp; It provides failover, performance-routing HTTP requests between different servers, whether they are on the cloud or on-premises. Application Gateway provides many Application Delivery Controller (ADC) features including HTTP load balancing, cookie-based session affinity, Secure Sockets Layer (SSL) offload, custom health probes, support for multi-site, and many others.</em></p><p>I like to say that it is at time a Reverse Proxy, a Web Application Firewall (WAF) and a layer 7 load balancer.<h2>Internal Resource Model</h2></p><p>Let’s start with a summary diagram.&nbsp; Each box represent a sub resource (except <em>Application Gateway</em>, which represents the main resource) and each of the bullet point within the box represent a property of that sub resource.</p><p><a href="assets/2017/7/azure-application-gateway-anatomy/image4.png"><img title="image" style="border:0 currentcolor;border-image:none;display:inline;background-image:none;" alt="image" src="assets/2017/7/azure-application-gateway-anatomy/image_thumb4.png" border="0"/></a></p><p>We can now look at each sub resource.</p><h3>Application Gateway</h3><p>Key properties of the gateway itself are</p><ul><li>The SKU, i.e. the tier (Small, Medium, Large) &amp; the number of instances (1 to 10)</li><li>A list of SSL certificates (used by HTTP Listeners)</li></ul><p>SSL Certificates are optional if the Gateway exposes only HTTP endpoints but are required for HTTPS endpoints.</p><p>The SKU can be anything, although <a href="https://azure.microsoft.com/en-us/support/legal/sla/application-gateway/v1_0/" target="_blank">in order to have an SLA</a>, it must be of tier medium or large and have at least 2 instances.</p><h3>Gateway IP Configuration</h3><p>The Gateway IP Configuration has a 1:1 relationship with the Application Gateway (trying to register a second configuration results in an error) and can therefore be conceptually considered as properties of the Gateway directly.</p><p>It simply defines in which subnet does the Application Gateway live.</p><h3>Frontend IP Configuration</h3><p>This sub resource defines how the gateway is exposed.</p><p>There can be either one or two of those configuration:&nbsp; either public or private or both.</p><p>The same configuration can be used by more than one HTTP listener, using different port.</p><h3>Frontend Port</h3><p>Frontend ports describe which ports on the Application Gateway are exposed.&nbsp; It simply is a port number.</p><h3>HTTP Listener</h3><p>This is a key component.&nbsp; It combines a frontend IP configuration and port ; it also include a protocol (HTTP or HTTPS) and optionally an SSL certificate.</p><p>An HTTP listener is what the Application Gateway is listening to, e.g.:</p><ul><li>Public IP X.Y.Z.W on port 443, HTTPS with a given SSL</li><li>Private IP 10.0.0.1 on port 80, HTTP</li></ul><h3>Backend Address Pool</h3><p>The real compute handling requests.</p><p>Typically it’s going to be stand-alone VMs or VMs from a VM Scale Set (VMSS) but technically only the addresses are registered.&nbsp; It could therefore be some public web site out there.</p><h2>Backend HTTP Setting</h2><p>This component describe how to connect to a backend compute:&nbsp; port#, protocol (HTTP / HTTS) &amp; cookie based affinity.</p><p>The frontend &amp; backend can be different:&nbsp; we can have HTTPS on 443 on the frontend while routing it to HTTP on port 12345 in the backend.&nbsp; This is actually a typical SSL termination scenario.</p><h2>Probe</h2><p>A probe, actually a custom probe, probes a backend for health.&nbsp; It is described by a protocol, a URL, interval, timeout, etc.&nbsp; .&nbsp; Basically we can customize how a backend is determined to be healthy or not.</p><p>A custom probe is optional.&nbsp; By default, a default probe is configured probing the backend using the port and protocol specified in the backend http setting.</p><h2>Rule</h2><p>A rule binds an HTTP Listener, a backend address pool together &amp; a backend setting.&nbsp; It basically binds and endpoint in the frontend with an endpoint in the backend.</p><p>There are two types of rules:&nbsp; basic rules &amp; path rules.&nbsp; The former simply binds the aforementioned components together while the later adds the concept of mapping a URL pattern to a given backend.</p><h2>Summary</h2><p>We covered the anatomy of Application Gateway and articulated how different components relate to each others.</p><p>In future articles we will build on this anatomy in order to address specific scenarios.</p>